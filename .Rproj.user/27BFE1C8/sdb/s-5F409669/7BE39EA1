{
    "contents" : "rm(list = c(ls()))\n##--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~---++\n##     \t\t\t\t\t\t\t\t\t\t\n##\tNES 2012 Broadband vs. Dial-up Partisan Exposure   \t\n##\tYph Lelkes\t\t\t\t\t\t\n## \tLast Edited: 10/31/14 by YL\n##--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~---++\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(gtools, Hmisc,plyr, stargazer,cem,MatchIt,effects,ggthemr,gridExtra,xtable)\n\nload(\"CopyOfanes_timeseries_2012.sav\")\n# Prepping for Matching\nformatch$interest_following <- as.numeric(droplevels(formatch$interest_following))\nformatch$income <- quantcut(as.numeric(formatch$inc_incgroup_pre),q = seq(from=0,to=1,by=.25))\nformatch$race <- (droplevels(formatch$dem_raceeth_x))\nformatch$age <- quantcut(as.numeric(formatch$dem_age_r_x),q = seq(from=0,to=1,by=.25))\n\n# Matching using CEM\nmatched <- matchit(as.numeric(broadband)-1~interest_following+income+race+educ+age+gender_respondent_x,data = formatch,method=\"cem\")\n# Matched dataset\nmatched12 <- match.data(matched)\nsummary(matched)\n## Effect of broadband on media choice\nconmedia <- glm(conmedia>0~pid2*broadband+interest_following+income+race+educ+age+gender_respondent_x, data=matched12,weight=weights,family=\"binomial\")\nlibmedia <- glm(libmedia>0~pid2*broadband+interest_following+income+race+educ+age+gender_respondent_x, data=match.data(matched),weight=weights,family=\"binomial\")\n\n# Export effects to data.frame using effects package  \nc1 <- (effect(conmedia,term=\"pid2*broadband\"))\nl1 <- (effect(libmedia,term=\"pid2*broadband\"))\n\n############################ \n## ggplot                 ##\n############################ \nforggplot <- rbind(\n  data.frame(y=inv.logit(c1$fit),pid=c1$x[,1],internet=c1$x[,2],upper=inv.logit(c1$upper),lower=inv.logit(c1$lower),media=\"Probability of Selecting \\n Conservative Media\"),\n  data.frame(y=inv.logit(l1$fit),pid=l1$x[,1],internet=l1$x[,2],upper=inv.logit(l1$upper),lower=inv.logit(l1$lower),media=\"Probability of Selecting \\n Liberal Media\")\n  )\n\n\n### Code to switch facet_strips\nswitch_facet_strip <- function(p, switch = c(\"x\", \"y\")) {\n  \n  require(gtable)\n  rbind_gtable <- gtable:::rbind_gtable\n  cbind_gtable <- gtable:::cbind_gtable\n  \n  if (\"y\" %in% switch)\n    p <- p + theme(strip.text.y = element_text(vjust = 0.5, angle = 90))\n  \n  g <- ggplotGrob(p)\n  \n  \n  gdim <- as.numeric(g$layout[g$layout$name == \"background\", c(\"b\", \"r\")])\n  tpos <- g$layout[g$layout$name == \"strip-top\", \"b\"][1]\n  rpos <- g$layout[g$layout$name == \"strip-right\", \"r\"][1]\n  new_tpos <- g$layout[g$layout$name == \"axis-b\", \"b\"][1] + 1\n  new_rpos <- g$layout[g$layout$name == \"axis-l\", \"r\"][1] - 1\n  \n  if (\"x\" %in% switch) {\n    g <- rbind_gtable(\n      rbind_gtable(\n        gtable_add_rows(\n          rbind_gtable(g[1:tpos-1, ] , g[(tpos+1):(new_tpos-1), ], \"first\"),\n          unit(5, units = \"mm\")),\n        g[tpos, ], \"first\"),\n      g[new_tpos:gdim[1], ], \"first\")\n  }\n  \n  if (\"y\" %in% switch) {\n    g <- cbind_gtable(\n      cbind_gtable(\n        gtable_add_cols(\n          cbind_gtable(g[, 1:new_rpos], g[, rpos], \"first\"),\n          unit(5, units = \"mm\")),\n        g[, (new_rpos+2):rpos-1], \"first\"),\n      g[, (rpos+1):gdim[2]], \"first\")\n  }\n  \n  grid.newpage()\n  grid.draw(g)\n}\n\n###\nlevels(forggplot$pid) <- c(\"Democrats\",\"Independents\",\"Republicans\")\nggthemr(\"fresh\")\np <- ggplot(subset(forggplot,pid!='Independents'),aes(x=internet,y=y))+\n\t\tfacet_grid(media~pid)+geom_bar(stat=\"identity\")+\n\t\tgeom_linerange(aes(ymin=lower,ymax=upper,y=y))+\n\t\tylab(\"\")+\n\t\txlab(\"Type of Connection at Home\")\n\nswitch_facet_strip(p,\"y\")\n\ndev.copy2pdf(file=\"figures/naesbbonmedia.pdf\", width = 8, height = 6)\n\n### Regressions\nformatch$interest_following <- as.numeric((formatch$interest_following))\nformatch$income <- quantcut(as.numeric(formatch$inc_incgroup_pre),q = seq(from=0,to=1,by=.25))\nformatch$race <- (droplevels(formatch$dem_raceeth_x))\nformatch$age <- quantcut(as.numeric(formatch$dem_age_r_x),q = seq(from=0,to=1,by=.25))\nformatch$educ <- factor(formatch$educ,levels=c(\"HS or Less\",\"Some College\",\"College\",\"More than College\"))\n\nconmedia1 <- glm(conmedia>0~broadband+interest_following+income+race+educ+age+gender_respondent_x, data=subset(formatch,pid2=='Republican'),family=\"binomial\")\nconmedia2 <- glm(conmedia>0~broadband+interest_following+income+race+educ+age+gender_respondent_x, data=subset(formatch,pid2=='Democrat'),family=\"binomial\")\n\n\nlibmedia1 <- glm(libmedia>0~broadband+interest_following+income+race+educ+age+gender_respondent_x, data=subset(formatch,pid2=='Republican'),family=\"binomial\")\nlibmedia2 <- glm(libmedia>0~broadband+interest_following+income+race+educ+age+gender_respondent_x, data=subset(formatch,pid2=='Democrat'),family=\"binomial\")\n\nlibrary(stargazer)\n\nstargazer(conmedia1,conmedia2,libmedia1,libmedia2,covariate.labels = c(\"Dial-Up\",\"Political Interest\",\"Income: 2nd Quartile\",\"Income: 3rd Quartile\",\"Income: 4th Quartile\",\"Race: Black\",\"Race: Hispanic\",\"Race: Other\",\"Education: Some College\",\"Education: College\",\"Education: More than College\",\"Age: 2nd Quartile\",\"Age: 3rd Quartile\",\"Age: 4th Quartile\",\"Female\",\"Intercept\"),dep.var.labels = c(\"Selected Conservative Media\",\"Selected Liberal Media\"),column.labels = c(\"Republicans\",\"Democrats\",\"Republicans\",\"Democrats\"),model.numbers = F,out = \"tables/nesregs.tex\",label=\"tab:nesregs\",title =\"Log-odds of selecting partisan media condition on internet speed by Party ID\",no.space = T)\n\nfortabs <- summary(matched)\nf1 <- cbind(fortabs$sum.all[,1:2],fortabs$sum.matched[,1:2])\nrownames(f1) <- c(\"Distance\",\"Political Interest\",\"Income 1st Quartile\",\"Income 2nd Quartile\",\"Income 3rd Quartile\",\"Income 4th Quartile\",\"Black\",\"Hispanic\",\"Race, Other\",\"Education, HS or Less\",\"Education: More than College\",\"Education: Some college\",\"Age, 2nd Quartile\",\"Age 3rd Quartile\",\"Age 4th Quartile\",\"Female\")\n\naddtorow <- list()\naddtorow$pos <- list(-1)\naddtorow$command <- paste0('\\\\hline Covariate & \\\\multicolumn{2}{c}{All} & \\\\multicolumn{2}{c}{Matched}', '\\\\\\\\')\nprint(xtable(f1),add.to.row=addtorow,file=\"tables/balanceanes.tex\",floating=F)\n",
    "created" : 1442831671283.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3046248613",
    "id" : "7BE39EA1",
    "lastKnownWriteTime" : 1438689974,
    "path" : "C:/Users/Yphtach/Dropbox/sharelatex/Broadband and Polarization/CopyOfReplication_File 2/scripts/anesgraph.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "type" : "r_source"
}