{
    "contents" : "##--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~---++\n##   \t\t\t\t\t\t\t\t\t\t\t\n##\t\tSelective Exposure/Polarization\n##\t\tMain Survey: Recode\n##\t\tLast Edited: 3.25.13   \t\n##\t\tYph Lelkes and Gaurav Sood\t\n##--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~---++\n\n# Lets make paths so that they are relative from SelectiveExposurePolarization basedir.\n\n# Set Working dir.\n\t# Leave for GS: setwd(paste0(basedir, \"SelectiveExposurePolarization\"))\n# Source functions\n\tsource(\"../../Dropbox/func.R\")    \n\n# Load data\n\tload(\"Data/selex.recode.rdata\")\n\tdata <- foreign::read.spss(\"Data/STAN0053_OUTPUT.sav\",to.data.frame=T)\n# PID\n\tdata$pid3 <- car::recode(as.numeric(data$pid7),\"1:2='Democrat';6:7='Republican';else='Independent'\",as.factor=T)\n\tdata$pid2 <- car::recode(as.numeric(data$pid7),\"1:3='Democrat';5:7='Republican';else=NA\",as.factor=T)\n\tdata$strongpartisan <- car::recode(as.numeric(data$pid7),\"1=1;7=1;else=0\")\n\t\n# Sociodem.\n\t#data$gender\n\tdata$age\t\t<- zero1(2011-data$birthyr)\t\n\tdata$south\t\t<- car::recode(data$inputstate,\"c('Texas','Oklahoma','Arkansas','Louisiana','Mississippi','Alabama','Georgia','Tennessee','Kentucky','West Virginia','Virginia','Maryland','Delaware','Kentucky','South Carolina','North Carolina','Florida')=1;else=0\")\n  data$single\t\t<- car::recode(data$marstat,\"'Single'=1;else=0\")\n\tdata$educnum\t<- car::recode(as.numeric(data$educ),\"1:2='Hs or Less';3:4='Some College';5:6='College+'\",as.factor=T)\n\tdata$race\t\t<- car::recode(as.numeric(data$race),\"1='White';else='Non-White'\")\n\t\n# Partisan Feelings\n\t##Traditional Affective Polarization Feeling Thermometer\n\tdata$therm_rp[data$therm_rp>100]=NA\n\tdata$therm_dp[data$therm_dp>100]=NA\n  \n  data$outfeelings <- NA\n\tdata$outfeelings[which(data$pid2=='Republican')] <- data$therm_dp[which(data$pid2=='Republican')]\n\tdata$outfeelings[which(data$pid2=='Democrat')]\t <- data$therm_rp[which(data$pid2=='Democrat')]\n\tdata$infeelings <- NA\n\tdata$infeelings[which(data$pid2=='Democrat')] <- data$therm_dp[which(data$pid2=='Democrat')]\n\tdata$infeelings[which(data$pid2=='Republican')]\t <- data$therm_rp[which(data$pid2=='Republican')]\n\tdata$affpol_ft <- zero1(data$infeelings - data$outfeelings)\n\t\n  ##Relative feelings about party supporters\n\n\tdata$likescale_sdem <- car::recode(data$likescale_sdem,\"997=NA\")\n\tdata$likescale_srep <- car::recode(data$likescale_srep,\"997=NA\")\n\t\n\tdata$likesin <- NA\n\tdata$likesin[which(data$pid2=='Democrat')] <- data$likescale_sdem[which(data$pid2=='Democrat')]\n\tdata$likesin[which(data$pid2=='Republican')] <- data$likescale_srep[which(data$pid2=='Republican')]\n\t\n\tdata$likesout <- NA\n\tdata$likesout[which(data$pid2=='Republican')] <- data$likescale_sdem[which(data$pid2=='Republican')]\n\tdata$likesout[which(data$pid2=='Democrat')] <- data$likescale_srep[which(data$pid2=='Democrat')]\n\tdata$personpolarization <- zero1(data$likesin - data$likesout)\ndata$caseid <- as.factor(data$caseid)\ndata[data>100]=NA\n  \ndata$demelites <-   rowMeans(data.frame(\n  zero1(as.numeric(data$feeling3)),\n  zero1(as.numeric(data$happy_dem)),\n  zero1(as.numeric(data$angry_rep)),\n  zero1(data$therm_bo),\n  zero1(data$therm_jb),\n  zero1(data$likescale_bo),\n  zero1(data$likescale_hc)),na.rm=T)\n  \n  data$repelites <- rowMeans(data.frame(\n  zero1(as.numeric(data$feeling4)),\n\tzero1(as.numeric(data$happy_rep)),\n\tzero1(as.numeric(data$angry_dem)),\n\tzero1(data$therm_rs),\n\tzero1(data$therm_mr),\n\tzero1(data$likescale_mr),\n\tzero1(data$likescale_sp)),na.rm=T)\n  \n  data$elitesfeels <- NA\n  data$elitesfeels[which(data$pid2=='Democrat')] =   data$demelites[which(data$pid2=='Democrat')] - data$repelites[which(data$pid2=='Democrat')]\n  \n\tdata$elitesfeels[which(data$pid2=='Republican')] =   data$repelites[which(data$pid2=='Republican')] - data$demelites[which(data$pid2=='Republican')]\n  \n  \n  data$iddem <- abs(zero1(car::recode(as.numeric(data$ideo_dem),\"8=NA\")-4)-1)\n\tdata$idrep <- zero1(car::recode(as.numeric(data$ideo_dem),\"8=NA\")-4)\n\ndata$extremity <- NA\ndata$extremity[which(data$pid2=='Republican')]=  data$iddem[which(data$pid2=='Republican')]\n\tdata$extremity[which(data$pid2=='Democrat')]=  data$idrep[which(data$pid2=='Democrat')]\n  \n# \tdata$angryout[which(data$pid2==\"Republican\")] = data$angry_dem[which(data$pid2==\"Republican\")]\n# \tdata$angryout[which(data$pid2==\"Democrat\")] = data$angry_rep[which(data$pid2==\"Democrat\")]\n# \t\n# \tdata$angryout[which(data$pid2==\"Republican\")] = data$angry_dem[which(data$pid2==\"Republican\")]\n# \tdata$angryout[which(data$pid2==\"Democrat\")] = data$angry_rep[which(data$pid2==\"Democrat\")]\n# \t\n#   \n# \tdata$angryin <- NA\n# \tdata$angryin[which(data$pid2==\"Republican\")] = data$angry_rep[which(data$pid2==\"Republican\")]\n# \tdata$angryin[which(data$pid2==\"Democrat\")] =  data$angry_dem[which(data$pid2==\"Democrat\")]\n#   \n#   data$angrydiff <- data$angryout-data$angryin\n# #######\n# \tdata$happyout <- NA\n# \tdata$happyout[which(data$pid2==\"Republican\")] = data$happy_dem[which(data$pid2==\"Republican\")]\n# \tdata$happyout[which(data$pid2==\"Democrat\")] = data$happy_rep[which(data$pid2==\"Democrat\")]\n# \t\n# \tdata$happyin <- NA\n# \tdata$happyin[which(data$pid2==\"Republican\")] = data$happy_rep[which(data$pid2==\"Republican\")]\n# \tdata$happyin[which(data$pid2==\"Democrat\")] = data$happy_dem[which(data$pid2==\"Democrat\")]\n#   \n# \tdata$happydiff <- data$happyin-data$happyout\n# cor(with(data,data.frame(happydiff,angrydiff)),use=\"pairwise.complete.obs\")  \n# \t\n# data$happycongress <- rowMeans(data.frame(data$angrydiff,data$happydiff),na.rm=F)\n#   ##Perceived Polarization, difference in difference\n# \tdata$rep_likescale_srep <- car::recode(data$rep_likescale_srep,\"997=NA\")\n# \tdata$rep_likescale_sdem <- car::recode(data$rep_likescale_sdem,\"997=NA\")\n# \tdata$dem_likescale_sdem <- car::recode(data$dem_likescale_sdem,\"997=NA\")\n# \tdata$dem_likescale_srep <- car::recode(data$dem_likescale_srep,\"997=NA\")\n#   \n#  data$perceivedpolarizationreps <-  zero1(with(data, abs(rep_likescale_srep-rep_likescale_sdem)))\n#   \n# \tdata$perceivedpolarizationdems <-  zero1(with(data, abs(dem_likescale_srep-dem_likescale_sdem)))\n# \tcor(with(data,data.frame(perceivedpolarizationdems,perceivedpolarizationreps,happycongress)),use=\"pairwise.complete.obs\")\n                                           \n  ##\n  with(data, psych::alpha(data.frame(as.numeric(feeling1),as.numeric(feeling2),as.numeric(feeling3),as.numeric(feeling4))))\n\tdata$socialdems <- as.numeric(data$feeling1)\n\tdata$socialreps <- as.numeric(data$feeling2)\n\tdata$socialdistancepolarization <- NA\n\tdata$socialdistancepolarization[which(data$pid2=='Democrat')] <- zero1(data$socialdems[which(data$pid2=='Democrat')]-data$socialreps[which(data$pid2=='Democrat')])\n\tdata$socialdistancepolarization[which(data$pid2=='Republican')] <- zero1(data$socialreps[which(data$pid2=='Republican')]-data$socialdems[which(data$pid2=='Republican')])\n\n  data$affectivepolarization\t<- zero1(rowMeans(with(data,data.frame(affpol_ft,personpolarization)),na.rm=T))\nlibrary(\"weights\")\nwith(data, wtd.cor(x=affpol_ft,y=personpolarization,weight=weight))\n\n  use=\"pairwise.complete.obs\")  \n  # # \t\n# \tpsych::alpha(with(data,data.frame(affpol_ft,personpolarization,happycongress)))\n  library(plyr)\n# Political Activism\n\tdata$eventsinterest <- car::recode(as.numeric(data$eventsinterest),\"5=NA\")\n\tdata$newsint\t\t<- car::recode(as.numeric(data$newsint),\"5=NA\")\n  data$registered <- car::recode(as.numeric(data$votereg),\"3=2\")\n  source(\"../func.R\")\n\tdata$activist\t\t<- abs(zero1(rowMeans(cbind(data$eventsinterest, data$newsint),na.rm=T))-1)\n  data$activist <-  rowMeans(data.frame(data$activist,data$pk),na.rm=T)\n  hist(data$activist)\n  data$pidfolded <-   as.numeric(data$pid7)\n\tdata$pidfolded[as.numeric(data$pid7)==8]=4\n  data$pidfolded <- abs(data$pidfolded-4)\ndata$pidfolded <-   car::recode(data$pidfolded,\"0='Pure I';1='Leaner';2='Weak';3='Strong'\",as.factor=T)\ndata$pidfolded <-   relevel(data$pidfolded,ref='Pure I')\n  # Political Knowledge\n\t#source(\"pk.recode.R\")\n\tload(\"Data/abilityscores.Rdata\")\n\tdata$pk <- zero1(z1$F1)\n  # Selective Exposure\n\tsource(\"./Study 1 Code/selfselectionvariable.R\")\n\tdata$ssindex <- rowMeans(with(data,data.frame(ss1,ss2,ss3,ss4),na.rm=F))\n\tsource(\"./Study 1 Code/hsvariable.R\")\n\tdata$hsindex <- rowMeans(with(data,data.frame(hs1==\"Soft\",hs2==\"Soft\",hs3==\"Soft\",hs4==\"Soft\"),na.rm=F))\n\t#polycor::hetcor(data.frame(dr,as.factor(data$voter)))\n\tdata$snewsk <- rowMeans(data.frame(selex$snews1r,selex$snews2r))\n###Ratio of how close R follows soft news to how closely R follows hard news\n\tdata$snewsg1 <- abs((as.numeric(data$snewsg1))-5)\n\tdata$snewsg2 <- abs((as.numeric(data$snewsg2))-5)\n\tdata$snewsg3 <- abs((as.numeric(data$snewsg3))-5)\n\tdata$snewsg4 <- abs((as.numeric(data$snewsg4))-5)\n\tdata$snewsg5 <- abs((as.numeric(data$snewsg5))-5)\n\tdata$snewsg6 <- abs((as.numeric(data$snewsg6))-5)\n\tdata$snewsg7 <- abs((as.numeric(data$snewsg7))-5)\n\tdata[,4:18] <-   abs(mapply(FUN=as.numeric,data[,4:18])-4)\n  \tdata$softnews <- zero1((with(data, rowMeans(data.frame(snewsg2,snewsg3,snewsg7))))/(with(data, rowMeans(data.frame(snewsg4, snewsg5,snewsg6)))))\n###Ratio of how close R follows soft news to how closely R follows hard news\n\tdata$followsoftnews <- zero1(with(data, rowMeans(data.frame(snewsg2,snewsg3,snewsg7))))\n  \n\tdata$congruentindex <- rowMeans(data.frame(data$tss1==\"Congruent\",data$tss2==\"Congruent\",data$tss3==\"Congruent\",data$tss4==\"Congruent\"))\n\t  \n##  product of (not interaction term) prop. hard news and prop. congenial\ndata$hsindexssindex <- data$hsindex * data$ssindex\n  da\n## Proportion of  times R selected hard and congruent\ndata$hardsel <- rowMeans(data.frame(data$hs1=='Hard' & data$tss1==\"Congruent\",data$hs2=='Hard' & data$tss2==\"Congruent\",data$hs3=='Hard' & data$tss3==\"Congruent\",data$hs4=='Hard' & data$tss4==\"Congruent\"))\n\t\n\tdata$softsel <- rowMeans(data.frame(data$hs1=='Soft' & data$tss1==\"Congruent\",data$hs2=='Soft' & data$tss2==\"Congruent\",data$hs3=='Soft' & data$tss3==\"Congruent\",data$hs4=='Soft' & data$tss4==\"Congruent\"))\n\t\n\tdata$hardnon <- rowMeans(data.frame(data$hs1=='Hard' & data$tss1==\"Incongruent\",data$hs2=='Hard' & data$tss2==\"Incongruent\",data$hs3=='Hard' & data$tss3==\"Incongruent\",data$hs4=='Hard' & data$tss4==\"Incongruent\"))\n\t\n##Left-Right Net\ndata$leftrightnet <- data$left-data$right\n\n##battleground states\n\tdata$battleground\t\t<- car::recode(data$inputstate,\"c('Colorado','Florida','Iowa','Nevada','New Hampshire','North Carolina','Ohio','Virginia','Wisconsin')=1;else=0\")\n\tdata$negativetimes1 <- 0\n\tdata$negativetimes1[data$video1=='Negative Romney' & data$pid2=='Republican']=1\n\tdata$negativetimes1[data$video1=='Negative Obama' & data$pid2=='Democrat']=1\n\t\n\tdata$negativetimes2 <- 0\n\tdata$negativetimes2[data$video2=='Negative Bachman' & data$pid2=='Republican']=1\n\tdata$negativetimes2[data$video2=='Negative Pelosi' & data$pid2=='Democrat']=1\ndatawt <- data\n# save(datawt,file=\"Data/datawithtreatment.RData\")\n#   load(\"Data/datawithtreatment.RData\")\n#   datawt$treatment\n# prop.table(with(datawt,table(hs2,treatment)),2)\n#   datawt$hs2\n# \t\n# \tdata <- subset(data,as.numeric(treatment)==1)\n  ####\n\tdata <- subset(data,as.numeric(treatment)==1)\n\t\n  ##Latent Partisan Selectivity\n\tgrdata1 <- with(data,data.frame(lr1,lr2,lr3,lr4))\n\tlibrary(ltm)\n  b <- grm(grdata1)\n\tfscores <- factor.scores(b)\n\tnewdf <- fscores$score.dat\n\ttobind <- as.data.frame(data.matrix(grdata1))\n\ttobind$join <- do.call(paste, c(tobind, sep = \"\"))\n  newdf$join <- do.call(paste, c(newdf[,1:4], sep = \"\"))\n\tdata$selectivityz1 <-\n    cor(newdf$z1[match(tobind$join,newdf$join)],dat\n  ###hsnews latent\n  hsl <- with(data,data.frame(data.matrix(data.frame(hs1,hs2,hs3,hs4))-1))\n  b <- ltm(hsl~z1)\n  plot(b)\t\n\tfscores <- factor.scores(b)\n\tnewdf <- fscores$score.dat\n\ttobind <- as.data.frame(data.matrix(hsl))\n\ttobind$join <- do.call(paste, c(tobind, sep = \"\"))\n\tnewdf$join <- do.call(paste, c(newdf[,1:4], sep = \"\"))\n\tdata$hsz1 <- zero1(newdf$z1[match(tobind$join,newdf$join)])  \n  cor(data$hsz1,rowMeans(hsl),use=\"pairwise.complete.obs\")\n\tvideolong <- reshape(data, idvar='caseid', varying=list(c(\"videoslant1\",\"videoslant2\"),c(\"tone1\",\"tone2\"),c(\"negativetimes1\",\"negativetimes2\")) ,direction='long')  \n\t# Save data\n\tsave(data,file=\"Data/codedstudy1.RData\")\n\tsave(videolong,file=\"Data/videolong.RData\")\n\t\n  \n  mysample <- data[sample(1:nrow(data), 100,replace=FALSE),]\n\t\n\tsamplelong <- reshape(mysample, idvar='caseid', varying=list(c(\"tss1\",\"tss2\",\"tss3\",\"tss4\"),c(\"hs1\",\"hs2\",\"hs3\",\"hs4\"),c(\"lr1\",\"lr2\",\"lr3\",\"lr4\")) ,direction='long')\n\t\n\t# Reshape data\n  datal <- reshape(data, idvar='caseid', varying=list(c(\"tss1\",\"tss2\",\"tss3\",\"tss4\"),c(\"hs1\",\"hs2\",\"hs3\",\"hs4\"),c(\"lr1\",\"lr2\",\"lr3\",\"lr4\")) ,direction='long')\n  datal$tss <- as.factor(datal$tss1)\n\tdatal$tss <- relevel(datal$tss,ref=\"Incongruent\")\n\tdatal$trial <- as.factor(datal$time)\n\tdatal$lr1 <- as.factor(datal$lr1)\n\tdatal$personorg <- car::recode(datal$time,\"1=0;3=0;2=1;4=1\")\n\t\n  \n# psych::alpha(data.frame(data$affpol_ft,data$personpolarization))\n# \t\n# \t\n# \tdata$inparty_signs  <- ifelse((data$pid2=='Democrat' & data$sign_insert==levels(data$sign_insert)[2])| \n# \t                                (data$pid2=='Republican' & data$sign_insert==levels(data$sign_insert)[1]),1,0)\n# \tlibrary(ltm)\n# \t### Trait Polarization\n# \tdata$trait_inparty <- NA\n# \tdata$trait_inparty <- ifelse((as.numeric(data$trait_insert)==1 & data$pid2==\"Democrat\")|as.numeric(data$trait_insert)==2 & data$pid2==\"Republican\",1,0)\n# \tinpartytraits <- with(data,as.data.frame(data.matrix(data.frame(trait1,trait2,trait3,trait4,trait5,trait6,trait7,trait8,trait9,caseid))))\n# \t# \tinpartytraits <-\tmapply(zero1,inpartytraits)\n# \t# \tinpartytraits[,c(1,3,5,6,8,9)] <- mapply(function(x)abs(x-1),inpartytraits[,c(1,3,5,6,8,9)])\n# \t# data$traitsscore <- rowMeans(inpartytraits,na.rm=T)\n# \t#       \n# \tb <- grm(inpartytraits[1:9])\n# \tfscores <- factor.scores(b)\n# \tnewdf <- fscores$score.dat\n# \ttobind <- as.data.frame(data.matrix(inpartytraits))\n# \ttobind$join <- do.call(paste, c(tobind[1:9], sep = \"\"))\n# \tnewdf$join <- do.call(paste, c(newdf[,1:9], sep = \"\"))\n# \tdata$traitsz1 <-   newdf$z1[match(tobind$join,newdf$join)]\n# \t#data <- merge(data,tobind,by=\"caseid\",all.x=T,all.y=T)\n# \t#  data$traitsz1 <- abs(zero1(data$traitsz1.y)-1)\n# \tpsych::alpha(with(data,data.frame(affpol_ft,personpolarization)))\n# \t# \tdata$traitsz1 <- abs(zero1(d1$traitsz1.y)-1)\n# \tdata$traitsz1[data$trait_inparty==1]=NA\n# \tdata$traitsz1 <- abs(zero1(data$traitsz1)-1)\n# \t",
    "created" : 1442589062444.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "237801718",
    "id" : "2A2E9D69",
    "lastKnownWriteTime" : 1373988512,
    "path" : "~/Dropbox/SelectiveExposurePolarization/scripts/study1code.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}