{
    "contents" : "---\ntitle: \"Using R for Data Wrangling, Analysis, and Visualization\"\nauthor: \"Dr. Yphtach Lelkes\"\nhighlighter: highlight.js\noutput: pdf_document\njob: null\nknit: slidify::knit2slides\nmode: selfcontained\nhitheme: tomorrow\nsubtitle: 'Lecture 3: Last things about data structures, starting some graphics'\nframework: io2012\nwidgets: []\n---\n## How was the problem set?\n\n---\n## Today\n1. Lists\n2. Starting with graphs\n3. You'll need to follow along on the slides posted here: https://github.com/ylelkes/R_wav\n\n---\n## Various functions you perform on the entire dataset (or subsets)\n* colSums(), rowSums(), colMeans(), rowMeans()\n* Use the USArrests dataset in the datasets package data(datasets::USArrests). \n* What was the total # of violent crimes by state?\n* What was the average number of each violent crime across all states?\n* For states where more than 70 percent of the population lives in cities, what is the average number of attacks, by crime?\n\n---\n* What was the total # of violent crimes by state?\n```{r}\nhead(rowSums(USArrests[,c(1,2,4)]))\n```\n\n* What was the average number of each violent crime across all states?\n```{r}\ncolMeans(USArrests[,c(1,2,4)])\n```\n\n---\n\n* For states where more than 70 percent of the population lives in cities, what is the average number of attacks, by crime?\n\n```{r}\ncolMeans(subset(USArrests,USArrests$UrbanPop>70)[,c(1,2,4)])\n```\n\n\n---\n## Lists\n\n* A list is a type of object that can hold any other object\n```\nnewlist <- list(mtcars,letters,6)\nnewlist[[2]]\n```\n* Index or subset within a list\n```\nnewlist[[1]][,6]\n```\n* Will become much more useful down the road. \n\n---\n* Try the following:\n  * Run the following code:\n  \n  <sub>\n  ```\n listexample <-  \n list(experiment1=data.frame(condition=c(\"Control\",\"Treat\"),score=rnorm(100)),\n experiment2=data.frame(condition=c(\"Control\",\"Treat\"),score=rnorm(100)),\n experiment3=data.frame(condition=c(\"Control\",\"Treat\"),score=rnorm(100)))\n  ```\n  </sub>\n  \n  * Generate the mean score for Treatment and Control for each dataset\n  * When you're done try the following:\n  \n  ```\nlapply(listexample,function(x)c(Treatment=mean(subset(x,condition==\"Treat\")$score),\nControl=mean(subset(x,condition==\"Control\")$score)))\n    ```\n\n---\n## R base graphics\n```\nhist(mtcars$mpg)\nplot(mtcars$mpg~mtcars$hp)\nboxplot(mtcars$mpg,mtcars$cyl)\n```\n\n---\n## R base graphics\n* Generally ugly\n* Enter Hadley Wickham\n* ![Hadley Wickham](http://www.statistics.rice.edu/uploadedImages/Faculty/hadley-rice%201.JPG)\n* ggplot2: The grammar of graphics\n* Easy to start with, but you can end up with complex figures. \n* Today will do part 1. In a few weeks we'll do part 2. \n\n---\n## ggplot2\n\n```\ninstall.packages(ggplot2)\n```\n\n### Every ggplot2 object has three components\n1. data,\n\n2. A set of aesthetic mappings between variables in the data and visual properties, and\n\n3. At least one geom, geometric object (or later), which describes how to render each observation.\n\n```\nlibrary(ggplot2)\nggplot(mpg, aes(x = displ, y = hwy)) +geom_point()\n```\n\n---\n## Exercises (1)\n1. What is this showing? \n```\nggplot(mpg, aes(model, manufacturer)) + geom_point() \n```\n2. Can you make it more informative?\n\n3. Describe the data, aesthetic mappings and layers used for each of the following plots. See if you can predict what the plot will look like before running the code.\n\n```\nggplot(mpg, aes(cty, hwy)) + geom_point()\nggplot(diamonds, aes(carat, price)) + geom_point()\nggplot(economics, aes(date, unemploy)) + geom_line()\nggplot(mpg, aes(cty)) + geom_histogram()\n```\n\n---\n## Aesthetics\n\n```\naes(displ, hwy, colour = class)\naes(displ, hwy, shape = drv)\naes(displ, hwy, size = cyl)\n```\n\n```\nggplot(mpg, aes(displ, cty)) + \n  geom_point()\nggplot(mpg, aes(displ, cty, colour = class)) + \n  geom_point()\nggplot(mpg, aes(displ, cty)) +  geom_point(color=\"blue\")\n```\n\n---\n## Exercises\n1. Experiment with the colour, shape and size aesthetics. What happens when you map them to continuous values? What about categorical values? \n\n2. What happens when you use more than one aesthetic in a plot?\n\n3. What happens if you map a continuous variable to shape? Why? What happens if you map trans to shape? Why?\n\n---\n##\n[Plot the graphs found in part 1, found here:](https://github.com/ylelkes/R_wav/blob/master/Week2-a/makethesegraphs.pdf)\n* If you finish early, start exploring ggplot--change the x-axis, rotate labels, label scales, change the x-y limits, check out themes (e.g., theme_bw)\n\n---\n## Saving your graphs\n* ggsave(filename=\"x.pdf\",width=8,height=8)\n\n* ggsave(filename=\"x.png\",width=8,height=8)\n\n* etc\n\n\n\n---\n## Facetting :Tables of graphics\n\n```{r,warning=F,message=F,fig.height=6}\nlibrary(ggplot2)\nggplot(mpg, aes(displ, hwy)) + geom_point() +facet_wrap(~class)\n```\n\n---\n## Facetting \nMake the graphs found in Part 2. Hint, need a different facet function for the second graph\n\n\n---\n## Plotting errors\n\n* In most plots, we want to display uncertainty\n* Here need to display a xmin and xmax OR a ymin and a ymax within the geom\n\n```{r,warning=F,message=F,fig.height=4,echo=F}\ndf <- data.frame(\n  trt = factor(c(1, 1, 2, 2)), \n  resp = c(1, 5, 3, 4), \n  group = factor(c(1, 2, 1, 2)), \n  se = c(0.1, 0.3, 0.3, 0.2)\n)\nlimits <- aes(ymax = resp + se, ymin=resp - se)\n\np <- ggplot(df, aes(colour=group, y=resp, x=trt))\np + geom_line(aes(group=group)) + geom_errorbar(limits, width=0.2)    \n```\n\n* Work on part 3 in the graphs section.\n\n---\n## Building a plot layer by layer\n\n```\np <- ggplot(as.data.frame(state.x77), aes(Illiteracy, Murder))\np\nr <- p+geom_point()\nr\nj <- r+geom_smooth(method=\"lm\")\nj\nj+geom_text(aes(label=rownames(as.data.frame(state.x77))))\n```\n\n---\n## Annotate your graphics\n\n```{r,message=F}\nlibrary(devtools)\nsource_gist(\"524eade46135f6348140\")\nlibrary(ggplot2)\nstate.x77 <- as.data.frame(state.x77)\np1 <- ggplot(data = state.x77, aes(x = Illiteracy, y = Murder, label=Murder)) +\n  stat_smooth_func(geom=\"text\",method=\"lm\",hjust=0,parse=TRUE) +\n  geom_smooth(method=\"lm\",se=FALSE) +\n  geom_point() \n```\n\n---\n```{r}\np1\n```\n\n---\n## Try this:\n1. Write code to figure out the state with the highest murder rate (not just by looking at the matrix)\n2. using the annotate command and ggplot, create a scatterplot and label that point with the state's name.\n\n---\n##\n```{r,eval=F}\nmurderhi <- as.data.frame(state.x77)[as.data.frame(state.x77)$Murder==max(as.data.frame(state.x77)$Murder),]\nggplot(data = state.x77, aes(x = Illiteracy, y = Murder, label=Murder)) +\n  geom_smooth(method=\"lm\",se=FALSE) + \n  geom_point()+annotate(\"text\", label = rownames(murderhi),\n  y = murderhi$Murder, x = murderhi$Illiteracy, size = 5,\ncolour = \"red\")+geom_point()\n```\n\n\n---\n## Scales\n\n* Scales control the mapping from data to aesthetics. They take your data and turn it into something that you can see, like size, colour, position or shape. \n\n```{r,fig.height=5}\nggplot(msleep, aes(bodywt,awake)) + geom_point()\n```\n\n---\n```{r}\nggplot(msleep, aes(log(bodywt),awake)) + \n  geom_point()+xlab(\"Body Weight (logged)\")+\n  scale_y_continuous(breaks=seq(0,25,by=1),\"Hours Awake\")\n```\n\n---\n```{r,warning=FALSE,echo=T}\n p2 <- ggplot(msleep, aes(log(bodywt),awake,colour=vore,shape=vore,lty=vore)) +\n  geom_point()+scale_y_continuous(breaks=seq(0,25,by=1),\"Hours Awake\")+\n  scale_color_manual(values=c(\"red\",\"blue\",\"black\",\"green\"))+\n  scale_shape_manual(values = c(0, 5, 6, 15))+theme_classic()+\n  ggtitle(\"Mammals, body weight, and sleep\")+geom_smooth(method=\"lm\",se=F)\n```\n\n---\n```{r,warning=FALSE,echo=F}\n p2 \n```\n\n---\n## Starting to reshape data\n\n```{r}\nwidedata <- data.frame(RID=1:100,T1=rnorm(100),T2=rnorm(100),\n                       T3=rnorm(100),gender=c(\"Male\",\"Female\"))\nhead(widedata)\n```\n\n---\n\n```{r}\nlibrary(reshape2)\nlongdata <- melt(widedata,id.vars = c(\"RID\",\"gender\"),measure.vars = c(\"T1\",\"T2\",\"T3\"))\nhead(longdata[order(longdata$RID),])\n```\n\n---\n\n* Melt the asylum data into long form. Create a time series plot where you choose a subset of refugees from 4-5 countries and track their flows over the 4 quarters. Use scales to set the linetypes and colors. \n* Try the directlabels package (geom_dl) and label the endpoints with the country of origin of each country. Might need to use the expand_limits() function. \n\n\n\n\n\n\n\n",
    "created" : 1441615623751.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4050732892",
    "id" : "FCF126BC",
    "lastKnownWriteTime" : 1442304765,
    "path" : "~/Dropbox/R_wav/Week2-b/Untitled.Rmd",
    "project_path" : "Week2-b/Untitled.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}