{
    "contents" : "rm(list=c(ls()))\n# ##--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~---++\n# ##           \t\t\t\t\t\t\t\n# ##\tPrepping County Level Data  \t\n# ##\tfor Hostile Audience, AJPS\n# ##  Yphtach Lelkes\t\t\t\t\t\t\n# ## \tLast Edited: 15/07/15 by yl\n# ##--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~---++\n# \nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(stringr, dplyr, reshape2,foreign)\n\n## rescale items to lie between 0 and 1\nzero1 <- function(x, minx=NA, maxx=NA){\n  res <- NA\n  if(is.na(minx)) res <- (x - min(x,na.rm=T))/(max(x,na.rm=T) -min(x,na.rm=T))\n  if(!is.na(minx)) res <- (x - minx)/(maxx -minx)\n  res\n}\n\n# ###\n   xwalk <- read.csv(\"data/ZIP_COUNTY_032010.csv\")\n   xwalk <- rbind(data.frame(xwalk,year=2004),data.frame(xwalk,year=2008))\n   xwalk$fipscode <- str_pad(xwalk$COUNTY,width = 2,pad=\"0\",side=\"left\")\n   p2004 <- read.csv(\"data/providers_ziplevel2004.csv\")\n   p2008 <- read.csv(\"data//providers_ziplevel2008.csv\")\n  providers <- rbind(data.frame(p2004[,1:3],year=2004),data.frame(p2008[,1:3],year=2008))\n  providers$state <- state.name[match(providers$state,state.abb)]\n  providers <- merge(xwalk,providers,by.x=c(\"ZIP\",\"year\"),by.y=c(\"zipcode\",\"year\"),all.x=T)\n  providers$zipproviders[is.na(providers$zipproviders)]=0\n  providers <- group_by(providers,year,state,fipscode)\n  providers <- summarise(providers,providers=mean(zipproviders,na.rm=T))\n\nbbindex2 <- read.csv(\"data/bbindex.csv\")\nbbindex2$state <- gsub(\"_\",\" \",bbindex2$State)\nbbindex2$Total <-  (bbindex2$Total)\n\ncountyproviders <- na.omit(merge(providers,bbindex2,by=\"state\"))\ncountyproviders$state <- as.factor(countyproviders$state)\nhhinc <- read.csv(\"data/countyincome.csv\")\nhhinc$HHINC[hhinc$HHINC==0]=NA\nhhinc$HHINC <- (hhinc$HHINC)\nhhinc$fipscode <- paste(str_pad(hhinc$FIPSST,width = 2,pad=\"0\",side=\"left\"),str_pad(hhinc$FIPSCNTY,width = 3,pad=\"0\",side=\"left\"),sep=\"\")\ncountyproviders$fipscode <- str_pad(countyproviders$fipscode,width=5, side=\"left\", pad=\"0\")\ncountyproviders <-   merge(hhinc,countyproviders,by=\"fipscode\")\n\ndensity <- read.csv(\"data/popdensity.csv\")\ndensity$fipscode <- str_pad(density$FIPS.Codes,width=5,pad=\"0\",side=\"left\")\ndensity$density <- zero1(density$density)\ncountyproviders <- merge(density,countyproviders,by=\"fipscode\")\n\n\ncountydemos <- subset(read.csv(\"data/POP2000.csv\"),year==2004|year==2008)\ncountydemos$percent_male <- countydemos$tot_male/countydemos$tot_pop\ncountydemos$percent_white <- (countydemos$wa_male+countydemos$wa_female)/countydemos$tot_pop\ncountydemos$percent_black <- (countydemos$ba_male+countydemos$ba_female)/countydemos$tot_pop\ncountydemos$percent_hispanic <- (countydemos$h_male+countydemos$h_female)/countydemos$tot_pop\n   \n   \n\ncountydemos$fipscode <- str_pad(countydemos$fips,width=5,pad=\"0\",side=\"left\")\ncountyproviders <- merge(countyproviders,countydemos[,c(6,50:ncol(countydemos))],by=c(\"fipscode\",\"year\"))\n\neducation <- read.csv(\"data/Education_fipscode.csv\")\neducation$fipscode <- str_pad(education$fips,width=5,pad=\"0\",side=\"left\")\ncountyproviders <- merge(countyproviders,education,by=c(\"fipscode\"))\n\ncounties <- foreign::read.dta(\"data/county_characteristics.dta\")\ncounties$fipscode <- str_pad(counties$FIPS,width=5,pad=\"0\",side=\"left\")\ncounties$state <- counties$StateName\ncounties$region <- counties$Region\n\n\ncounties$typography <- counties$Typography\ncounties$lowed <- counties$LowEduc04\ncounties$unemploymentrate <- counties$UnempRate05\ncchar <- counties[,c(1,471:ncol(counties))]\ncountyproviders <- merge(countyproviders,cchar,by=c(\"fipscode\",\"state\"))\n\nslope <- read.dta(\"data//zctasloperoads shared publicly.dta\")\nslope <- merge(xwalk,slope,by.x=\"ZIP\",by.y=\"zcta5\")\nslope <- group_by(slope,fipscode)\nslope <- summarise(slope,slope=mean(slope,na.rm=T),road=mean(roads,na.rm=T))\ncountyproviders <- merge(slope,countyproviders,by=\"fipscode\",all.y=T)\n\ncountyproviders <- countyproviders[,c(\"fipscode\",\"state\",\"year\",\"density\",\"providers\",\"Total\",\"Deployment\",\"Supply\",\"Demand\",\"HHINC\",\"percent_male\",\"percent_white\",\"percent_black\",\"lowed\",\"region\",\"unemploymentrate\",\"typography\",'slope','road')]\n\nload(\"data/naesall_0408.RData\")\nnaesall_0408$fipscode <- str_pad(naesall_0408$fipscode,width=5,pad=\"0\",side=\"left\")\ncountyproviders <- filter(countyproviders,countyproviders$fipscode %in% unique(naesall_0408$fipscode))\nmerged <- merge(countyproviders,naesall_0408,by=c(\"fipscode\",\"year\"),all.y=T)\n\nsave(merged,file=\"data/mergeddataset.RData\")\nsave(countyproviders,file=\"data/mergedcounty.RData\")\n\n",
    "created" : 1441023073425.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1225432234",
    "id" : "90C0A4D5",
    "lastKnownWriteTime" : 1438020263,
    "path" : "~/Dropbox/sharelatex/Broadband and Polarization/Replication_File/scripts/County_Level_Data.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}